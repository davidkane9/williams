---
title: "Williams College Faculty and Graduates"
author: "Karan Tibrewal and David Kane"
date: "`r Sys.Date()`"
output:
  tufte::tufte_html: default
  tufte::tufte_handout:
    citation_package: natbib
    latex_engine: xelatex
  tufte::tufte_book:
    citation_package: natbib
    latex_engine: xelatex
---


```{r, echo = FALSE}
knitr::opts_chunk$set(tidy = FALSE,
                      echo = FALSE, 
                      message = FALSE, 
                      warning = FALSE)
```


## Introduction

This document provides an overview of the data available in the wiliamsmetrics package. We have data on the faculty and graduates of Williams College from the 1999--2000 academic year through 2014--2015.

```{r}
library(dplyr)
library(stringr)
library(ggplot2)
library(williamsmetrics)
data(graduates_details)
x <- graduates_details
```

## Faculty

```{r}
data("faculty")
data("faculty_details")
```

There were `r dim(faculty_details)[1]` faculty at Williams from `r min(faculty_details$year)` through `r max(faculty_details$year)`. The number of faculty averages about `r round(mean(table(faculty_details$year)))` per year. The largest class was `r as.numeric(tail(sort(table(faculty_details$year)), n = 1))` in 
`r as.numeric(names(tail(sort(table(faculty_details$year)), n = 1)))`. The smallest was 
`r as.numeric(head(sort(table(faculty_details$year)), n = 1))` in
`r as.numeric(names(head(sort(table(faculty_details$year)), n = 1)))`. 

###Department

```{r}
faculty.na <- faculty_details[which(!is.na(faculty_details$department)), ]
grouped <-  group_by(faculty.na, year, department)
summary.df <- summarise(grouped, number_of_faculty = n())
summary.df.top10 <- summary.df[with(summary.df, order(-number_of_faculty)), ] %>% filter(year == max(summary.df$year))
summary.df.top10 <- summary.df.top10[1:10, ]
```



The course catalogs do not directly provide the department for faculty. Instead, we try to infer the department by a faculty's title. For some, this is easy. For example, "Daniel P. Aalberts, Assistant Professor of Physics" definitely belongs to Physics, and "Colin C. Adams, Francis Christopher Oakley Third Century Professor of Mathematics" to Mathematics.    

Others are more complicated. For example, consider "Bernadette Brooten, Croghan Bicentennial Visiting Professor in Biblical
and Early Christian Studies, Spring Semester". Although, from Bernadette Brooten's title, it is fairly obvious that she is a Professor of Religion, her department cannot be inferred from the naive procedure with which we infer Colin Adams' or Daniel Alberts' department. We need to handle these cases separately.    

Alas, others are, still, more complicated. "Jennifer Austin, Assistant Professor of Romance Languages" is a case in point: it is obvious that she teaches Romance Languages, but does she teach French, Italian, or Spanish? These cases need to be handled explicitly.       


According to our findings, the top 10 departments in terms of faculty employed for the latest year we have data for (`r paste(max(faculty_details$year), max(faculty_details$year) + 1, sep = '-')`) are: 

```{r}
summary.df.top10  %>% as.data.frame()
```

```{r, fig.cap="Top 10 departments by number of faculty employed"}
filter.summary <- summary.df %>% filter(department %in% summary.df.top10$department)
p <- ggplot(data = filter.summary, aes(x = year, y = number_of_faculty, color = department)) + geom_line() + labs(x = "Year", y = "Number of faculty")

p 
```

###Birth Year

The course catalogs provide the year a faculty member graduated from college. Assuming (perhaps incorrectly in some cases) that she is 22 when she graduates, we infer her birth year.   

```{r}
faculty$age <- 2017 - faculty$birth.year
oldest <- paste(faculty$first.name[which(faculty$age == max(faculty$age, na.rm = T))], faculty$last.name[which(faculty$age == max(faculty$age, na.rm = T))], sep = ' ')
youngest <- paste(faculty$first.name[which(faculty$age == min(faculty$age, na.rm = T))], faculty$last.name[which(faculty$age == min(faculty$age, na.rm = T))], sep = ' ')
```

We find that the oldest faculty currently in the college are `r oldest[1]` and `r oldest[2]`. The youngest faculty currently in the college are `r youngest[1]` and `r youngest[2]`. 

###MEAN STATS

```{r}
faculty$age <- 2017 - faculty$birth.year
qplot(faculty$age, geom="histogram", fill = I("purple"), color = I("black") )

```

```{r}
qplot(faculty$age[which(faculty$gender == "male")], geom="histogram", fill = I("blue"), color = I("black") )
```

```{r}
qplot(faculty$age[which(faculty$gender == "female")], geom="histogram", fill = I("red"), color = I("black") )
```

The average age for both male and female faculty has constantly decreased over the years (with the only exception of slight increases during 2007 to 2009. This is, perhaps, expected in view of the financial crisis when Williams had to considerably downsize its faculty. Presumably, newer, and hence, younger faculty, were disproportionately axed).   

```{r, fig.cap="Average age of faculty by gender"}
faculty_details$age <- 2017 - faculty_details$birth.year
grouped.year <- dplyr::group_by(faculty_details, year, gender)
summary.year <- dplyr::summarise(grouped.year, avg_age = mean(age, na.rm = T))
ggplot(data = summary.year, aes(x = year, y = avg_age, fill = gender)) + geom_bar(stat = "identity", position = "dodge")
```


####### FACULTY AGE BY RACE

```{r}
grouped.year <- dplyr::group_by(faculty_details, year, race)
summary.year <- dplyr::summarise(grouped.year, avg_age = mean(age, na.rm = T))
ggplot(data = summary.year, aes(x = year, y = avg_age, fill = race)) + geom_bar(stat = "identity", position = "dodge")
```

## Graduates

There were `r dim(x)[1]` graduates of Williams from `r min(x$year)` through `r max(x$year)`. The number of graduates averages about `r round(mean(table(x$year)))` per year. The largest class was `r as.numeric(tail(sort(table(x$year)), n = 1))` in 
`r as.numeric(names(tail(sort(table(x$year)), n = 1)))`. The smallest was 
`r as.numeric(head(sort(table(x$year)), n = 1))` in
`r as.numeric(names(head(sort(table(x$year)), n = 1)))`. 

### Names

Names are interesting. The graduate with the longest name is 
`r x %>% select(year, full.name) %>% filter(min_rank(-nchar(full.name)) < 2) %>% as.character() %>% tail(1)` 
from the class of 
`r x %>% select(year, full.name) %>% filter(min_rank(-nchar(full.name)) < 2) %>% as.character() %>% head(1)`. The students with the shortest names are:

```{r, echo = FALSE}
x %>% select(year, full.name) %>% filter(min_rank(nchar(full.name)) < 2) %>% as.data.frame()
```

The students with the longest last name and first name are:

```{r, echo=FALSE}
x %>% select(year, full.name, first.name, last.name) %>% filter(min_rank(-nchar(first.name)) < 2 | min_rank(-nchar(last.name)) < 2) %>% select(-first.name, -last.name) %>% as.data.frame()
```

The students with at least 5 separate parts to their full names are:

```{r, echo=FALSE}
x[str_split(x$full.name, " ", simplify = TRUE)[,5] != "",] %>% select(year, full.name) %>% as.data.frame()
```

### Gender

The course catalogs do not provide the gender of the graduates, so we estimate it by using the **gender** package. 
`r tufte::margin_note("At some point, we hope to explore a more advanced approach: Kamil Wais (2016). genderizeR: Gender Prediction Based on First Names. R package version 2.0.0. https://CRAN.R-project.org/package=genderizeR")` Our gender variable looks like:

```{r}
table(x$gender, exclude = NULL)
```

The large number of NAs is a result of the gender package's focus on American names. Consider the most common problem cases:

```{r}
x %>% filter(is.na(gender)) %>% select(first.name, gender) %>% group_by(first.name, gender) %>% summarize(count = n()) %>% arrange(desc(count)) %>% as.data.frame() %>% head(12)
```

Most of the NAs for gender are due to unique first names, names that appear only once amoung the `r dim(x)[1]` graduates. Eventually, we might fix some of these by hand, especially those --- like JosÃ© --- for which we know the correct gender. There might also be simple ways to add international names. But, for now, we see no reason why these NA should bias any of the later analysis. 

```{r}
x %>% select(year, gender) %>% count(year, gender) %>% mutate(percentage = n/sum(n)) %>% ggplot(aes(year, percentage, color = gender)) + geom_line()
```

### Race

We use the wru package to estimate race. The totals for the entire data set are:

```{r}
table(x$race, exclude = NULL)
```

Judging by the the College's public statements and Common Data Set releases, we are significantly overestimating the percentage of white students.

```{r}
round(prop.table(table(x$race)), 3)
```

The "Other" category includes only a handful of students:

```{r}
x %>% filter(race == "Other") %>% select(full.name, race) %>% as.data.frame()
```

There is no publicly available source for the racial breakdown of the graduating class. (True? Check NEPS.) The 2015--2016 Common Data Set [reports](https://provost.williams.edu/files/williams_cds_1516_w_tuition.pdf) that, among all degree-seeking undergraduates at Williams, `r round(243/2065, 2)` Asian, `r round(157/2065, 2)` were 
Black, `r round(261/2065, 2)` Hispanic, `r round(1106/2065, 2)` White, and `r round((161 + 4 + 133)/2065, 2)` in other categories, including Nonresident Aliens, American Indian or Two-or-more races.

Our estimates for non-White students are too low. First, we don't even find the same number of Asian/Black/Hispanic students are we know to be at Williams among the US citizen portion of the population. Second, we categorize some/many of the students in the other categories (most importantly the international and multi-racial students) as being in non-White categories even though they are not so classified by Williams.

As an example, we classify Paige Lauren Whidbee '16 as Black. She is the only Phi Beta Kappa member of the class of 2016 that we so classify. However, according to this [photo](http://ephsports.williams.edu/sports/wgolf/2014-15/bios/whidbee_paige_2xmt?view=bio), she probably isn't African-American.





```{r}
x %>% select(year, race) %>% count(year, race) %>% mutate(percentage = n/sum(n)) %>% ggplot(aes(year, percentage, color = race)) + geom_line()
```
